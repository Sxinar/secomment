<div id="adm-app" style="max-width: 600px; margin: 0 auto; padding: 15px; font-family: sans-serif;">
    <div id="login-box" style="text-align:center; padding: 50px 0;">
        <h2>Admin Girişi</h2>
        <input type="email" id="email" placeholder="E-posta" style="width:100%; padding:12px; margin-bottom:10px;">
        <input type="password" id="pass" placeholder="Şifre" style="width:100%; padding:12px; margin-bottom:20px;">
        <button onclick="login()" style="width:100%; padding:12px; background:#111; color:#fff; border:none; border-radius:8px;">Giriş Yap</button>
    </div>

    <div id="dash" style="display:none;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h3>Yorum Yönetimi</h3>
            <button onclick="logout()" style="background:none; border:none; color:red; cursor:pointer;">Çıkış</button>
        </div>
        <div id="admin-list"></div>
    </div>
</div>

<style>
    .adm-card { background:#fff; border:1px solid #ddd; border-radius:12px; padding:15px; margin-bottom:15px; box-shadow:0 2px 4px rgba(0,0,0,0.05); }
    .adm-u { font-weight:700; color:#2563eb; }
    .adm-t { margin: 8px 0; font-size:14px; }
    .adm-actions { display:flex; gap:10px; margin-top:15px; }
    .btn { padding:8px 12px; border:none; border-radius:6px; cursor:pointer; font-size:12px; font-weight:600; }
    .btn-ok { background:#22c55e; color:#fff; }
    .btn-del { background:#ef4444; color:#fff; }
    .reply-box { margin-top:15px; display:none; }
    .reply-input { width:100%; padding:8px; border:1px solid #ccc; border-radius:6px; font-size:13px; }
</style>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getDatabase, ref, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const config = {
        apiKey: "AIzaSyAGw79xzO43dw5Vts7f2iV6vmA_BLxBJ1A",
        authDomain: "secoment.firebaseapp.com",
        databaseURL: "https://secoment-default-rtdb.firebaseio.com",
        projectId: "secoment"
    };

    const app = initializeApp(config);
    const auth = getAuth(app);
    const db = getDatabase(app);

    window.login = () => signInWithEmailAndPassword(auth, document.getElementById('email').value, document.getElementById('pass').value);
    window.logout = () => signOut(auth);

    onAuthStateChanged(auth, (user) => {
        document.getElementById('login-box').style.display = user ? 'none' : 'block';
        document.getElementById('dash').style.display = user ? 'block' : 'none';
        if(user) loadComments();
    });

    function loadComments() {
        onValue(ref(db, 'comments'), (snap) => {
            const list = document.getElementById("admin-list");
            list.innerHTML = "";
            snap.forEach((pageSnap) => {
                const pId = pageSnap.key;
                pageSnap.forEach((cSnap) => {
                    const v = cSnap.val();
                    const cId = cSnap.key;
                    list.innerHTML += `
                        <div class="adm-card">
                            <div class="adm-u">${v.u} <small style="color:#999">(${pId})</small></div>
                            <div class="adm-t">${v.t}</div>
                            <div class="adm-actions">
                                ${!v.approved ? `<button class="btn btn-ok" onclick="approve('${pId}','${cId}')">Onayla</button>` : `<span style="color:green; font-size:12px;">✅ Onaylı</span>`}
                                <button class="btn" style="background:#eee" onclick="showReply('${cId}')">Yanıtla</button>
                                <button class="btn btn-del" onclick="del('${pId}','${cId}')">Sil</button>
                            </div>
                            <div id="rb-${cId}" class="reply-box">
                                <input type="text" id="ri-${cId}" class="reply-input" placeholder="Yanıtınız..." value="${v.reply || ''}">
                                <button class="btn btn-ok" style="margin-top:5px; width:100%" onclick="saveReply('${pId}','${cId}')">Yanıtı Kaydet</button>
                            </div>
                        </div>`;
                });
            });
        });
    }

    window.approve = (p, c) => update(ref(db, `comments/${p}/${c}`), { approved: true });
    window.del = (p, c) => confirm("Silinsin mi?") && remove(ref(db, `comments/${p}/${c}`));
    window.showReply = (cId) => {
        const box = document.getElementById(`rb-${cId}`);
        box.style.display = box.style.display === 'block' ? 'none' : 'block';
    };
    window.saveReply = (p, c) => {
        const txt = document.getElementById(`ri-${c}`).value;
        update(ref(db, `comments/${p}/${c}`), { reply: txt, approved: true });
        alert("Yanıt kaydedildi ve yorum onaylandı.");
    };
</script>
